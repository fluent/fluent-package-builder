<source>
  @type sample
  tag test
</source>

<match **>
  @type s3

  aws_key_id localstack-test
  aws_sec_key localstack-test
  s3_region ap-northeast-1
  s3_bucket localstack-bucket
  s3_endpoint http://127.0.0.1:4566
  ssl_verify_peer false
  force_path_style true
  path logs-%Y-%m-%d
  s3_object_key_format %{path}-%{index}.json
  auto_create_bucket true

  <buffer time>
    @type file
    timekey 10s
    timekey_wait 5s
    path /tmp/test/s3
    flush_at_shutdown true
    flush_interval 0.1
  </buffer>
  <format>
    @type json
  </format>
</match>
